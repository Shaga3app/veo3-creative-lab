<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Shaga3app ¬∑ AI Creative Playground</title>

  <style>
    :root{
      --bg:#0b0f18;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --line:rgba(255,255,255,.10);
      --accent:#5b5cff;
      --ok:#22c55e;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1200px 900px at 30% -10%, rgba(91,92,255,.25), transparent 55%),
        radial-gradient(900px 700px at 80% 10%, rgba(34,197,94,.12), transparent 50%),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:860px;margin:0 auto;padding:18px 16px 40px;}
    .card{
      background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px;
      backdrop-filter:blur(10px);
    }

    /* Top bar */
    .topBar{
      display:flex;justify-content:space-between;align-items:center;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      gap:12px;
    }
    .brand{display:flex;align-items:center;gap:10px;font-weight:900}
    .logo{
      width:34px;height:34px;border-radius:10px;
      display:grid;place-items:center;
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      overflow:hidden;
    }
    .logo img{width:22px;height:22px;object-fit:contain;display:block}
    .pill{
      padding:7px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      font-size:12px;
      font-weight:900;
      white-space:nowrap;
    }
    .langBtn{
      font-size:12px; padding:7px 10px; border-radius:999px;
      border:1px solid var(--line); color: var(--text);
      background: rgba(255,255,255,.06);
      font-weight:900;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }

    /* Hero */
    .hero{margin:18px 0}
    .hero h1{font-size:52px;line-height:1.05;margin:6px 0;font-weight:950}
    .hero p{color:var(--muted);font-size:18px;max-width:580px;margin:0}

    .sectionLabel{
      margin:20px 0 10px;
      font-size:12px;
      letter-spacing:.14em;
      color:var(--muted);
    }

    /* Locked box */
    .lockedBox{
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
    }
    .lockedTop{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .lockedTag{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      font-weight:900;
      white-space:nowrap;
    }
    .lockedPrompt{
      margin-top:10px;
      border:2px dashed rgba(255,255,255,.16);
      border-radius:14px;
      padding:16px;
      font-family:ui-monospace,monospace;
      white-space:pre-wrap;
      color: rgba(255,255,255,.72);
      line-height:1.45;
    }

    /* Fields */
    .grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
    @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}.span2{grid-column:1/-1}}
    .field{
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
    }
    .field label{font-size:13px;margin-bottom:6px;display:block;font-weight:900}
    .field input{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      outline:none;
    }

    /* Carousel + preview */
    .demoCard{
      margin-top:14px;
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(0,0,0,.18);
      overflow:hidden;
    }
    .preview{
      position:relative;
      width:100%;
      aspect-ratio:16/9;
      background:#000;
    }
    .preview img,.preview video{
      width:100%;height:100%;
      object-fit:cover;
      display:block;
    }
    .preview video{display:none}
    .chip{
      position:absolute;top:10px;right:10px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.40);
      font-size:12px;font-weight:900;
      backdrop-filter: blur(8px);
    }

    .stripWrap{padding:12px;border-top:1px solid var(--line)}
    .strip{
      display:flex;gap:10px;overflow-x:auto;
      padding-bottom:6px;
      scroll-snap-type:x mandatory;
    }
    .thumb{
      flex:0 0 auto;
      width:92px;height:92px;
      border-radius:14px;
      overflow:hidden;
      border:2px solid transparent;
      background:rgba(255,255,255,.04);
      cursor:pointer;
      scroll-snap-align:start;
      position:relative;
    }
    .thumb.selected{border-color:var(--ok)}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .thumb .badge{
      position:absolute;bottom:6px;left:6px;
      font-size:11px;font-weight:900;
      padding:3px 7px;border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
    }

    .dots{
      display:flex;gap:6px;justify-content:center;
      padding-top:8px;
    }
    .dot{
      width:6px;height:6px;border-radius:99px;
      background:rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.12);
    }
    .dot.on{
      background:rgba(34,197,94,.85);
      border-color:rgba(34,197,94,.55);
    }

    /* Actions inside card (not sticky) */
    .actions{
      display:flex;gap:10px;flex-wrap:wrap;
      padding:12px;border-top:1px solid var(--line);
      justify-content:flex-end;
    }
    .btn{
      padding:12px 16px;
      border-radius:14px;
      border:none;
      font-weight:950;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .btn.primary{
      background:linear-gradient(180deg,var(--ok), color-mix(in srgb, var(--ok) 72%, #000));
      color:#07120a;
    }
    .btn.secondary{
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--text);
    }
    .btn:disabled{opacity:.55;cursor:not-allowed}

    .result{
      display:none;
      margin-top:12px;
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
      background:rgba(0,0,0,.18);
    }
    .progress{
      height:10px;border-radius:999px;
      background:rgba(255,255,255,.04);
      overflow:hidden;
      border:1px solid var(--line);
    }
    .bar{
      height:100%;width:0%;
      background:linear-gradient(90deg,var(--accent),var(--ok));
    }
    .miniHint{font-size:12px;color:var(--muted);line-height:1.35}
  </style>
</head>

<body>
<div class="wrap">
<div class="card">

  <div class="topBar">
    <div class="brand">
      <div class="logo"><img id="brandImg" alt="logo"></div>
      <span id="brandText">Shaga3app ¬∑ AI Creative Playground</span>
    </div>

    <div style="display:flex; gap:10px; align-items:center;">
      <button class="langBtn" id="langToggle" type="button">AR</button>
      <div class="pill" id="betaPill">Beta ¬∑ Shaga3app powered</div>
    </div>
  </div>

  <div class="hero">
    <h1 id="heroTitle">Play with our<br>guided video<br>prompt</h1>
    <p id="heroDesc">You get up to 3 tries. The core concept is fixed by us; you just add your creative twist ‚ú®</p>
  </div>

  <div class="sectionLabel" id="baseLabel">BASE CONCEPT (LOCKED)</div>
  <div class="lockedBox">
    <div class="lockedTop">
      <div class="lockedTag" id="lockedTag">üîí Locked</div>
      <div class="lockedTag"><span id="trialsLabel">Trials left:</span> <b id="trialsLeft">3</b></div>
    </div>
    <div class="lockedPrompt" id="basePrompt">Loading‚Ä¶</div>
  </div>

  <div class="sectionLabel" id="inputLabel">YOUR INPUT</div>
  <div class="grid">
    <div class="field">
      <label id="lblSubject">Main subject / character</label>
      <input id="subject" placeholder="Who is the main character? (age, style, wardrobe, vibe)">
    </div>
    <div class="field">
      <label id="lblLocation">Location / environment</label>
      <input id="location" placeholder="Where is it happening? (city, time of day, lighting, atmosphere)">
    </div>
    <div class="field span2">
      <label id="lblTwist">Extra creative twist</label>
      <input id="twist" placeholder="Optional: camera move, mood, style, or one special detail.">
    </div>
  </div>

  <!-- Demo carousel (poster thumbnails) + main preview -->
  <div class="demoCard">
    <div class="preview">
      <img id="mainPoster" alt="Selected poster">
      <video id="mainVideo" controls playsinline></video>
      <div class="chip" id="chipMeta">9:16 ¬∑ 5‚Äì8s</div>
    </div>

    <div class="stripWrap">
      <div class="strip" id="strip"></div>
      <div class="dots" id="dots"></div>
    </div>

    <div class="actions">
      <button class="btn secondary" id="copyBtn" type="button">üîó <span id="copyTxt">Copy link</span></button>
      <button class="btn secondary" id="downloadBtn" type="button">‚¨á <span id="dlTxt">Download</span></button>
      <button class="btn primary" id="generateBtn" type="button">‚ö° <span id="genBtnTxt">Generate video</span></button>
    </div>
  </div>

  <div class="result" id="resultBox">
    <div class="miniHint" id="timerText" style="margin-bottom:10px;">~60s</div>
    <div class="progress"><div class="bar" id="bar"></div></div>
  </div>

</div>
</div>

<script>
const $ = id => document.getElementById(id);

/* ===========================
   Your Lambda Function URL
=========================== */
const API_URL = "https://hhkaj4azuk6zqykrqdk2dmo6bi0mixvp.lambda-url.eu-central-1.on.aws/";
const MODEL_ID = "veo-3.1-generate-001";

let trials = 3;
let generating = false;

const LAST_URL_KEY = "shaga3app_last_video_url";

/* ===========================
   Brand loader
=========================== */
function getBrandKey(){
  const u = new URL(location.href);
  return (u.searchParams.get("brand") || "shaga3").toLowerCase();
}

async function loadBrandConfig(){
  const key = getBrandKey();
  const url = `brands/${key}.json?v=${Date.now()}`;
  const r = await fetch(url);
  const txt = await r.text();
  if(!r.ok) throw new Error(`Cannot load ${url} (HTTP ${r.status})`);
  let data;
  try { data = JSON.parse(txt); }
  catch(e){ throw new Error(`Bad JSON in ${url}. Make sure it is valid JSON (no trailing commas).`); }
  return data;
}

function applyTheme(cfg){
  document.documentElement.style.setProperty("--accent", cfg.accent || "#5b5cff");
  document.documentElement.style.setProperty("--ok", cfg.ok || "#22c55e");
}

/* ===========================
   Auto demo posters (NO UPLOADS)
   - If cfg.demoPosters is empty/missing, we generate posters automatically.
=========================== */
function buildAutoDemoPosters(brandKey, count=8){
  // Make different ‚Äúmood‚Äù per brand so it feels intentional
  const mood =
    brandKey === "cocacola" ? "red-cinema-coke" :
    brandKey === "tui" ? "travel-sea-hotel" :
    "ai-cinema-egypt";

  const baseSeed = `${brandKey}-${mood}-shaga3`;

  const arr = [];
  for(let i=1;i<=count;i++){
    // square posters: fast + app-like
    arr.push(`https://picsum.photos/seed/${encodeURIComponent(baseSeed+"-"+i)}/720/720`);
  }
  return arr;
}

/* ===========================
   Arabic digits helper
=========================== */
function toArabicDigits(str){
  const map = {"0":"Ÿ†","1":"Ÿ°","2":"Ÿ¢","3":"Ÿ£","4":"Ÿ§","5":"Ÿ•","6":"Ÿ¶","7":"Ÿß","8":"Ÿ®","9":"Ÿ©"};
  return String(str).replace(/[0-9]/g, d => map[d]);
}

let currentLang = "en";
let cfg = null;

/* ===========================
   UI labels
=========================== */
const labels = {
  en: {
    baseLabel: "BASE CONCEPT (LOCKED)",
    locked: "üîí Locked",
    trialsLabel: "Trials left:",
    inputLabel: "YOUR INPUT",
    lblSubject: "Main subject / character",
    lblLocation: "Location / environment",
    lblTwist: "Extra creative twist",
    phSubject: "Who is the main character? (age, style, wardrobe, vibe)",
    phLocation: "Where is it happening? (city, time of day, lighting, atmosphere)",
    phTwist: "Optional: camera move, mood, style, or one special detail.",
    gen: "Generate video",
    dl: "Download",
    copy: "Copy link",
    waiting: "Waiting for video‚Ä¶",
    done: "Done ‚úÖ"
  },
  ar: {
    baseLabel: "ÿßŸÑŸÖŸÅŸáŸàŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä (ŸÖŸÇŸÅŸàŸÑ)",
    locked: "üîí ŸÖŸÇŸÅŸàŸÑ",
    trialsLabel: "ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿßÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸäÿ©:",
    inputLabel: "ÿ™ŸÅÿßÿµŸäŸÑŸÉ",
    lblSubject: "ÿßŸÑÿ¥ÿÆÿµŸäÿ© / ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä",
    lblLocation: "ÿßŸÑŸÖŸÉÿßŸÜ / ÿßŸÑÿ®Ÿäÿ¶ÿ©",
    lblTwist: "ÿ•ÿ∂ÿßŸÅÿ© ÿ•ÿ®ÿØÿßÿπŸäÿ©",
    phSubject: "ŸÖŸäŸÜ ÿßŸÑÿ®ÿ∑ŸÑÿü (ÿ≥ŸÜ/ÿ≥ÿ™ÿßŸäŸÑ/ŸÖŸÑÿßÿ®ÿ≥/ÿ•ÿ≠ÿ≥ÿßÿ≥ ÿπÿßŸÖ)",
    phLocation: "ÿ£ŸäŸÜ ÿßŸÑŸÖŸÉÿßŸÜÿü (ŸÖÿØŸäŸÜÿ©/ŸàŸÇÿ™/ÿ•ÿ∂ÿßÿ°ÿ©/ÿ£ÿ¨Ÿàÿßÿ°)",
    phTwist: "ÿßÿÆÿ™Ÿäÿßÿ±Ÿä: ÿ≠ÿ±ŸÉÿ© ŸÉÿßŸÖŸäÿ±ÿß/ŸÖŸàÿØ/ÿ≥ÿ™ÿßŸäŸÑ/ÿ™ŸÅÿµŸäŸÑÿ© ŸÖŸÖŸäÿ≤ÿ©.",
    gen: "ÿ™ŸàŸÑŸäÿØ ŸÅŸäÿØŸäŸà",
    dl: "ÿ™ÿ≠ŸÖŸäŸÑ",
    copy: "ŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑",
    waiting: "ÿ®ŸÜÿ≥ÿ™ŸÜŸâ ÿßŸÑŸÅŸäÿØŸäŸà‚Ä¶",
    done: "ÿ™ŸÖ ‚úÖ"
  }
};

function applyLang(lang){
  currentLang = lang;
  const t = labels[lang];

  $("baseLabel").textContent = t.baseLabel;
  $("lockedTag").textContent = t.locked;
  $("trialsLabel").textContent = t.trialsLabel;
  $("inputLabel").textContent = t.inputLabel;

  $("lblSubject").textContent = t.lblSubject;
  $("lblLocation").textContent = t.lblLocation;
  $("lblTwist").textContent = t.lblTwist;

  $("subject").placeholder = t.phSubject;
  $("location").placeholder = t.phLocation;
  $("twist").placeholder = t.phTwist;

  $("genBtnTxt").textContent = t.gen;
  $("dlTxt").textContent = t.dl;
  $("copyTxt").textContent = t.copy;

  if(cfg){
    $("brandText").textContent = (lang === "ar") ? (cfg.brandText_ar || cfg.brandText_en || "AI Lab") : (cfg.brandText_en || "AI Lab");
    $("betaPill").textContent  = (lang === "ar") ? (cfg.beta_ar || cfg.beta_en || "Beta") : (cfg.beta_en || "Beta");
    $("heroTitle").innerHTML   = (lang === "ar") ? (cfg.heroTitle_ar || cfg.heroTitle_en || "AI Video Lab") : (cfg.heroTitle_en || "AI Video Lab");
    $("heroDesc").textContent  = (lang === "ar") ? (cfg.heroDesc_ar || cfg.heroDesc_en || "") : (cfg.heroDesc_en || "");
    $("basePrompt").textContent= (lang === "ar") ? (cfg.basePrompt_ar || cfg.basePrompt_en || "") : (cfg.basePrompt_en || "");
  }

  document.body.dir = (lang === "ar") ? "rtl" : "ltr";
  document.documentElement.lang = (lang === "ar") ? "ar" : "en";
  $("langToggle").textContent = (lang === "ar") ? "EN" : "AR";

  $("trialsLeft").textContent = (lang === "ar") ? toArabicDigits(String(trials)) : String(trials);
}

$("langToggle").addEventListener("click", () => {
  applyLang(currentLang === "en" ? "ar" : "en");
});

/* ===========================
   Carousel state
=========================== */
let items = [];     // {id, posterUrl, videoUrl, label}
let selectedId = null;

function renderDots(){
  const dots = $("dots");
  dots.innerHTML = "";
  items.forEach(it=>{
    const d = document.createElement("div");
    d.className = "dot" + (it.id === selectedId ? " on" : "");
    dots.appendChild(d);
  });
}

function renderStrip(){
  const strip = $("strip");
  strip.innerHTML = "";
  items.forEach(it=>{
    const el = document.createElement("div");
    el.className = "thumb" + (it.id === selectedId ? " selected" : "");
    el.innerHTML = `
      <img src="${it.posterUrl}" alt="poster">
      <div class="badge">${it.label || "Demo"}</div>
    `;
    el.onclick = ()=> selectItem(it.id);
    strip.appendChild(el);
  });
  renderDots();
}

function showPoster(url){
  $("mainPoster").src = url || "";
  $("mainPoster").style.display = "block";
  $("mainVideo").style.display = "none";
  $("mainVideo").removeAttribute("src");
  $("mainVideo").load();
}

function showVideo(url){
  $("mainVideo").src = url;
  $("mainVideo").style.display = "block";
  $("mainPoster").style.display = "none";
  $("mainVideo").load();
  $("mainVideo").play().catch(()=>{});
}

function selectItem(id){
  selectedId = id;
  const it = items.find(x=>x.id===id);
  if(!it) return;

  if(it.videoUrl){
    showVideo(it.videoUrl);
    saveLastUrl(it.videoUrl);
  } else {
    showPoster(it.posterUrl);
  }
  renderStrip();
}

function addGeneratedToCarousel(videoUrl){
  const id = "gen-" + Date.now();
  const posterFallback = items[0]?.posterUrl || "";
  items.unshift({ id, posterUrl: posterFallback, videoUrl, label:"New" });
  selectedId = id;
  renderStrip();
}

/* ===========================
   Save/restore last video
=========================== */
function saveLastUrl(url){
  try { localStorage.setItem(LAST_URL_KEY, url); } catch(e) {}
}
function loadLastUrl(){
  try { return localStorage.getItem(LAST_URL_KEY) || ""; } catch(e) { return ""; }
}

/* ===========================
   Prompt builder
=========================== */
function buildPrompt(){
  const base = $("basePrompt").textContent || "";
  const subject = ($("subject").value || "").trim();
  const location = ($("location").value || "").trim();
  const twist = ($("twist").value || "").trim();

  const parts = [];
  if(subject) parts.push(`Main subject: ${subject}`);
  if(location) parts.push(`Location: ${location}`);
  if(twist) parts.push(`Creative twist: ${twist}`);

  return `${base}\n\n---\n${parts.join("\n")}`.trim();
}

async function postJSON(payload){
  const url = API_URL + "?t=" + Date.now();
  const r = await fetch(url, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify(payload)
  });
  const text = await r.text();
  let data;
  try{ data = JSON.parse(text); } catch(e){ data = { raw:text }; }
  if(!r.ok){
    const msg = data?.error || data?.message || data?.raw || ("HTTP " + r.status);
    throw new Error(msg);
  }
  return data;
}

/* ===========================
   Progress UI
=========================== */
function showProgressUI(){
  $("resultBox").style.display = "block";
  $("bar").style.width = "0%";
}
function setTimerText(s){
  if(currentLang === "ar"){
    $("timerText").textContent = s > 0 ? toArabicDigits(`${s} ÿ´`) : labels.ar.waiting;
  } else {
    $("timerText").textContent = s > 0 ? `~${s}s` : labels.en.waiting;
  }
}

/* ===========================
   Generate
=========================== */
async function realGenerate(){
  if(generating || trials <= 0) return;
  generating = true;

  trials--;
  $("trialsLeft").textContent = (currentLang === "ar") ? toArabicDigits(String(trials)) : String(trials);

  showProgressUI();

  const maxSeconds = 60;
  const start = Date.now();
  let rafId;

  const tick = () => {
    const elapsed = (Date.now() - start) / 1000;
    const p = Math.min(95, (elapsed / maxSeconds) * 95);
    $("bar").style.width = p + "%";

    const remain = Math.max(0, Math.ceil(maxSeconds - elapsed));
    setTimerText(remain);

    rafId = requestAnimationFrame(tick);
  };
  tick();

  try{
    const prompt = buildPrompt();

    const gen = await postJSON({
      action:"generate",
      modelId: MODEL_ID,
      prompt
    });

    const operationName = gen.operationName || gen.name;
    const directUrl = gen.downloadUrl || gen.response?.downloadUrl;

    if(gen.done && directUrl){
      $("bar").style.width = "100%";
      $("timerText").textContent = (currentLang==="ar") ? labels.ar.done : labels.en.done;

      showVideo(directUrl);
      saveLastUrl(directUrl);

      addGeneratedToCarousel(directUrl);
      selectItem(items[0].id);
      return;
    }

    if(!operationName) throw new Error("No operationName returned from generate");

    const pollEveryMs = 3000;
    const maxPolls = 25;
    let doneUrl = "";

    for(let i=0;i<maxPolls;i++){
      await new Promise(res => setTimeout(res, pollEveryMs));
      const chk = await postJSON({
        action:"check",
        modelId: MODEL_ID,
        operationName
      });

      doneUrl = chk.downloadUrl || chk.response?.downloadUrl || "";
      if(chk.done && doneUrl) break;
    }

    if(!doneUrl) throw new Error("Still processing. Try again in a few seconds.");

    $("bar").style.width = "100%";
    $("timerText").textContent = (currentLang==="ar") ? labels.ar.done : labels.en.done;

    showVideo(doneUrl);
    saveLastUrl(doneUrl);

    addGeneratedToCarousel(doneUrl);
    selectItem(items[0].id);

  }catch(err){
    $("timerText").textContent = "Error: " + (err?.message || "Unknown error");
    $("bar").style.width = "0%";
  }finally{
    generating = false;
    if(rafId) cancelAnimationFrame(rafId);
  }
}

$("generateBtn").addEventListener("click", realGenerate);

/* ===========================
   Download / Copy
=========================== */
function getCurrentVideoUrl(){
  const v = $("mainVideo");
  return (v && v.src) ? v.src : loadLastUrl();
}
function downloadFile(url){
  if(!url) return;
  const a = document.createElement("a");
  a.href = url;
  a.download = "shaga3app-video.mp4";
  a.target = "_blank";
  a.rel = "noopener";
  document.body.appendChild(a);
  a.click();
  a.remove();
}
$("downloadBtn").addEventListener("click", () => {
  const url = getCurrentVideoUrl();
  if(!url) return;
  saveLastUrl(url);
  downloadFile(url);
});
$("copyBtn").addEventListener("click", async () => {
  const url = getCurrentVideoUrl();
  if(!url) return;

  saveLastUrl(url);
  try{
    await navigator.clipboard.writeText(url);
    alert(currentLang==="ar" ? "ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑ ‚úÖ" : "Link copied ‚úÖ");
  }catch(e){
    prompt(currentLang==="ar" ? "ÿßŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑:" : "Copy link:", url);
  }
});

/* ===========================
   Init
=========================== */
(async function init(){
  try{
    cfg = await loadBrandConfig();
    applyTheme(cfg);

    // logo (fallback if missing)
    const logoPath = cfg.logo || "assets/brand-logos/shaga3app.png";
    $("brandImg").src = logoPath + "?v=" + Date.now();

    // demo posters:
    // If cfg.demoPosters missing/empty => auto generate (NO uploads)
    let posters = Array.isArray(cfg.demoPosters) ? cfg.demoPosters : [];
    if(posters.length === 0){
      posters = buildAutoDemoPosters(getBrandKey(), 8); // change 8 -> 10/12 if you want more
    }

    items = posters.map((p,i)=>({
      id: "demo-"+i,
      posterUrl: p,
      videoUrl: "",
      label: "Demo"
    }));

    selectedId = items[0].id;
    renderStrip();
    showPoster(items[0].posterUrl);

    // restore last generated video (if exists)
    const last = loadLastUrl();
    if(last){
      addGeneratedToCarousel(last);
      showVideo(last);
      selectItem(items[0].id);
    }

    applyLang("en");

  }catch(e){
    $("basePrompt").textContent = "Error loading brand config: " + (e?.message || e);
    console.error(e);
  }
})();
</script>
</body>
</html>
