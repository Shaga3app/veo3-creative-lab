<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>AI Video Lab</title>

  <style>
    :root{
      /* DEFAULT (will be overridden by JS brand theme) */
      --pageBg1:#071021;
      --pageBg2:#050913;

      --cardBg1:rgba(255,255,255,.10);
      --cardBg2:rgba(255,255,255,.06);

      --text:#e5e7eb;
      --muted:#94a3b8;
      --line:rgba(255,255,255,.12);

      --brand:#5b5cff;
      --brand2:#22c55e;
      --pillBorder:rgba(91,92,255,.50);
      --pillBg:rgba(91,92,255,.20);
      --glowA:rgba(91,92,255,.22);
      --glowB:rgba(34,197,94,.10);

      --radiusCard:18px;
      --radiusField:14px;
      --shadow: 0 18px 45px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1200px 900px at 25% -10%, var(--glowA), transparent 55%),
        radial-gradient(900px 700px at 85% 10%, var(--glowB), transparent 55%),
        linear-gradient(180deg, var(--pageBg1), var(--pageBg2));
      color:var(--text);
    }

    .wrap{max-width:860px;margin:0 auto;padding:18px 16px 40px;}
    .card{
      background:linear-gradient(180deg,var(--cardBg1),var(--cardBg2));
      border:1px solid var(--line);
      border-radius:var(--radiusCard);
      padding:14px;
      backdrop-filter:blur(12px);
      box-shadow: var(--shadow);
    }

    /* Top bar */
    .topBar{
      display:flex;justify-content:space-between;align-items:center;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      gap:12px;
    }
    .brandRow{display:flex;align-items:center;gap:10px;font-weight:900;min-width:0}
    .logo{
      width:34px;height:34px;border-radius:10px;
      display:grid;place-items:center;
      background:rgba(255,255,255,.08);
      border:1px solid var(--line);
      overflow:hidden;
      flex:0 0 auto;
    }
    .logo img{width:22px;height:22px;object-fit:contain;display:block}
    .brandRow span{
      overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
      max-width:48vw;
    }

    .pill{
      padding:7px 12px;
      border-radius:999px;
      border:1px solid var(--pillBorder);
      background:var(--pillBg);
      font-size:12px;
      font-weight:950;
      white-space:nowrap;
    }
    .langBtn{
      font-size:12px; padding:7px 10px; border-radius:999px;
      border:1px solid var(--line); color: var(--text);
      background: rgba(255,255,255,.08);
      font-weight:950;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }

    .hero{margin:18px 0}
    .hero h1{font-size:52px;line-height:1.05;margin:6px 0;font-weight:950}
    .hero p{color:var(--muted);font-size:18px;max-width:560px}

    .sectionLabel{
      margin:18px 0 10px;
      font-size:12px;
      letter-spacing:.14em;
      color:var(--muted);
    }

    .lockedBox{
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
    }
    .lockedTop{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
    .lockedTag{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      font-weight:950;
    }

    /* ‚úÖ Locked prompt: smaller + more dim + less space */
    .lockedPrompt{
      margin-top:10px;
      border:2px dashed rgba(255,255,255,.16);
      border-radius:14px;
      padding:10px 12px;              /* less padding */
      font-family:ui-monospace,monospace;
      white-space:pre-wrap;
      font-size:11px;                 /* smaller */
      line-height:1.35;
      color: rgba(229,231,235,.62);   /* more dim */
      max-height:140px;               /* stops taking lots of space */
      overflow:auto;
    }

    /* ===== Video section ===== */
    .videoCard{
      margin-top:14px;
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(0,0,0,.18);
      padding:12px;
    }
    .videoTop{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .videoTop .title{
      font-weight:950;
      display:flex;align-items:center;gap:8px;
    }
    .chip{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.35);
      white-space:nowrap;
      font-weight:950;
    }

    .mainPreview{
      position:relative;
      width:100%;
      aspect-ratio: 9 / 16;
      border-radius:16px;
      overflow:hidden;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
    }

    .poster{
      position:absolute; inset:0;
      background-size:cover;
      background-position:center;
      filter:saturate(1.05) contrast(1.02);
    }
    .posterOverlay{
      position:absolute; inset:0;
      background:
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.55)),
        radial-gradient(900px 600px at 30% 10%, rgba(255,255,255,.08), transparent 55%),
        radial-gradient(900px 600px at 80% 30%, rgba(255,255,255,.05), transparent 60%);
      display:flex;
      align-items:flex-end;
      padding:16px;
    }
    .posterMeta{
      width:100%;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      font-weight:950;
      color:#fff;
      text-shadow:0 10px 22px rgba(0,0,0,.45);
    }
    .posterMeta .name{font-size:16px;opacity:.98}
    .posterMeta .tag{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.22);
      background:rgba(0,0,0,.35);
      backdrop-filter:blur(8px);
      opacity:.98;
      font-weight:950;
      white-space:nowrap;
    }

    video#mainVideo{
      position:absolute; inset:0;
      width:100%;
      height:100%;
      display:none;
      object-fit:cover;
      background:#000;
    }

    .playOverlay{
      position:absolute; inset:0;
      display:grid; place-items:center;
      pointer-events:auto;
    }
    .playBtn{
      width:74px;height:74px;border-radius:50%;
      display:grid;place-items:center;
      background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.18);
      font-size:22px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }

    /* Carousel thumbs: poster image + badge + play */
    .carousel{
      margin-top:10px;
      display:flex;gap:10px;
      overflow:auto;
      padding-bottom:6px;
      scrollbar-width: thin;
    }
    .thumb{
      width:98px;
      height:98px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      flex:0 0 auto;
      position:relative;
      overflow:hidden;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .thumb.active{ outline:2px solid var(--brand2); outline-offset:2px; }
    .thumbPoster{
      position:absolute; inset:0;
      background-size:cover;
      background-position:center;
      filter:saturate(1.05) contrast(1.02);
    }
    .thumbShade{
      position:absolute; inset:0;
      background:linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.72));
    }
    .thumbBadge{
      position:absolute;
      top:8px; right:8px;
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.45);
      color:#fff;
      font-weight:950;
      white-space:nowrap;
    }
    .thumbFooter{
      position:absolute; left:10px; right:10px; bottom:10px;
      display:flex;justify-content:space-between;align-items:center;gap:8px;
      color:#fff;
      font-weight:950;
    }
    .thumbFooter .lbl{font-size:11px;opacity:.98}
    .thumbFooter .pbtn{
      width:26px;height:26px;border-radius:50%;
      background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.20);
      display:grid;place-items:center;font-size:12px;
    }

    /* pagination dots */
    .dots{display:flex;justify-content:center;gap:6px;margin-top:8px;}
    .dot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.18);}
    .dot.on{background: var(--brand2);}

    .actionsRow{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;
      justify-content:flex-end;
    }

    .btn{
      padding:12px 16px;
      border-radius:14px;
      border:none;
      font-weight:950;
      cursor:pointer;
      background:linear-gradient(180deg,var(--brand2), color-mix(in srgb, var(--brand2) 75%, #000 25%));
      color:#07120a;
    }
    .btn.secondary{
      background:rgba(255,255,255,.08);
      border:1px solid var(--line);
      color:var(--text);
      text-decoration:none;
    }

    .result{
      display:none;
      margin-top:10px;
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
      background:rgba(0,0,0,.18);
    }
    .progress{
      height:10px;border-radius:999px;
      background:rgba(255,255,255,.06);
      overflow:hidden;
      border:1px solid var(--line);
    }
    .bar{
      height:100%;width:0%;
      background:linear-gradient(90deg,var(--brand), var(--brand2));
    }
    .miniHint{margin-top:8px;font-size:12px;color:var(--muted);line-height:1.35;opacity:.95}

    /* Inputs area */
    .modeBar{
      display:flex;gap:10px;
      border:1px solid var(--line);
      border-radius:14px;
      padding:8px;
      background:rgba(0,0,0,.18);
    }
    .modeBtn{
      flex:1;
      padding:10px;
      border-radius:12px;
      background:transparent;
      border:1px solid transparent;
      color:var(--muted);
      cursor:pointer;
      font-weight:950;
    }
    .modeBtn.on{
      background: color-mix(in srgb, var(--brand) 25%, transparent);
      border-color: color-mix(in srgb, var(--brand) 55%, transparent);
      color:var(--text);
    }

    .grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
    @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}.span2{grid-column:1/-1}}

    .field{
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      border-radius:var(--radiusField);
      padding:12px;
    }
    .field label{font-size:13px;margin-bottom:6px;display:block;font-weight:950}
    .field input{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">

    <div class="topBar">
      <div class="brandRow">
        <div class="logo">
          <img id="brandImg" alt="Brand logo" />
        </div>
        <span id="brandText">AI Video Lab</span>
      </div>

      <div style="display:flex; gap:10px; align-items:center;">
        <button class="langBtn" id="langToggle" type="button">AR</button>
        <div class="pill" id="betaPill">Beta</div>
      </div>
    </div>

    <div class="hero">
      <h1 id="heroTitle">Play with our<br>guided video<br>prompt</h1>
      <p id="heroDesc">You get up to <b id="triesInline">3</b> tries. The core concept is fixed by us; you just add your creative twist ‚ú®</p>
    </div>

    <div class="sectionLabel" id="baseLabel">BASE CONCEPT (LOCKED)</div>
    <div class="lockedBox">
      <div class="lockedTop">
        <div class="lockedTag" id="lockedTag">üîí Locked</div>
        <div class="lockedTag"><span id="trialsLabel">Trials left:</span> <b id="trialsLeft">3</b></div>
      </div>

      <div class="lockedPrompt" id="basePrompt"
        data-en="BASE (LOCKED)

Create a vertical 9:16 cinematic video, 5‚Äì8 seconds long, with smooth camera moves and rich, realistic lighting.
Include an ultra-realistic Coca-Cola can and an Egyptian flag in the scene, naturally integrated so they match the environment and do not feel placed or fake.
The scene follows this base concept, and we will inject the user details below."
        data-ar="ÿßŸÑÿ£ÿ≥ÿßÿ≥ (ŸÖŸÇŸÅŸàŸÑ)

ÿßÿπŸÖŸÑ ŸÅŸäÿØŸäŸà ÿ≥ŸäŸÜŸÖÿßÿ¶Ÿä ÿπŸÖŸàÿØŸä Ÿ©:Ÿ°Ÿ¶ ŸÖÿØÿ™Ÿá ŸÖŸÜ Ÿ• ŸÑŸÄ Ÿ® ÿ´ŸàÿßŸÜŸäÿå ÿ®ÿ≠ÿ±ŸÉÿ© ŸÉÿßŸÖŸäÿ±ÿß ŸÜÿßÿπŸÖÿ© Ÿàÿ•ÿ∂ÿßÿ°ÿ© ŸàÿßŸÇÿπŸäÿ© Ÿàÿ∫ŸÜŸäÿ©.
ŸÑÿßÿ≤ŸÖ Ÿäÿ∏Ÿáÿ± ÿπŸÑÿ®ÿ© ŸÉŸàŸÉÿßŸÉŸàŸÑÿß ŸàÿßŸÇÿπŸäÿ© ÿ¨ÿØŸãÿß ŸàÿπŸÑŸÖ ŸÖÿµÿ± ÿ¨ŸàŸëŸá ÿßŸÑŸÖÿ¥ŸáÿØ ‚Äî ÿ®ÿ¥ŸÉŸÑ ÿ∑ÿ®ŸäÿπŸä ŸàŸÖÿ™ŸÜÿßÿ≥ŸÇ ŸÖÿπ ÿßŸÑŸÖŸÉÿßŸÜÿå ŸÖŸÜ ÿ∫Ÿäÿ± ŸÖÿß Ÿäÿ®ÿßŸÜŸàÿß ŸÖÿ™ÿ≠ÿ∑ŸëŸäŸÜ ŸÉÿØŸá ÿ£Ÿà ŸÅŸäŸÉ.
ÿßŸÑŸÖÿ¥ŸáÿØ ŸÖÿßÿ¥Ÿä ÿπŸÑŸâ ÿßŸÑŸÅŸÉÿ±ÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ÿØŸäÿå Ÿàÿ•ÿ≠ŸÜÿß ŸáŸÜÿ∂ŸäŸÅ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ™ÿ≠ÿ™.">
BASE (LOCKED)
Create a vertical 9:16 cinematic video...
      </div>
    </div>

    <div class="videoCard">
      <div class="videoTop">
        <div class="title">üé¨ <span id="videoTitle">Selected demo</span></div>
        <div class="chip" id="metaChip">9:16 ¬∑ 5‚Äì8s</div>
      </div>

      <div class="mainPreview">
        <div class="poster" id="mainPoster"></div>
        <div class="posterOverlay" id="posterOverlay">
          <div class="posterMeta">
            <div class="name" id="posterName">Demo</div>
            <div class="tag" id="posterTag">9:16 ¬∑ 5‚Äì8s</div>
          </div>
        </div>

        <video id="mainVideo" controls playsinline preload="metadata"></video>

        <div class="playOverlay" id="playOverlay">
          <div class="playBtn" id="playBtn">‚ñ∂</div>
        </div>
      </div>

      <div class="carousel" id="carousel"></div>
      <div class="dots" id="dots"></div>

      <div class="actionsRow">
        <button class="btn secondary" id="copyBtn" type="button">üîó <span id="copyTxt">Copy link</span></button>
        <button class="btn secondary" id="downloadBtn" type="button">‚¨á <span id="dlTxt">Download</span></button>
        <button class="btn" id="generateBtn" type="button">‚ö° <span id="genBtnTxt">Generate video</span></button>
      </div>

      <div class="result" id="resultBox">
        <div class="miniHint" id="timerText" style="display:block;margin-top:0;margin-bottom:10px;">~10s</div>
        <div class="progress"><div class="bar" id="bar"></div></div>
      </div>

      <div class="miniHint" id="saveWarn" style="margin-top:10px">
        This page does not save your generated video. Please download it or copy the link before leaving.
      </div>
      <div class="miniHint" id="copyNote" style="display:none;margin-top:8px"></div>
    </div>

    <div class="sectionLabel" id="modeLabel">CHOOSE INPUT MODE</div>
    <div class="modeBar">
      <button class="modeBtn on" id="modeText" type="button">üìù <span id="modeTextTxt">Text prompt</span></button>
      <button class="modeBtn" id="modeImages" type="button">üñºÔ∏è <span id="modeImgTxt">Start + End images</span></button>
    </div>

    <div class="field span2" id="imagesBox" style="display:none; margin-top:10px;">
      <label id="lblImages">Start + End images</label>
      <input type="file" id="startImg" accept="image/*">
      <input type="file" id="endImg" accept="image/*" style="margin-top:8px;">
      <div class="miniHint" id="hintImages">Upload a start frame and an end frame to guide the motion.</div>
    </div>

    <div class="grid">
      <div class="field">
        <label id="lblSubject">Main subject / character</label>
        <input id="subject" placeholder="Who is the main character? (age, style, wardrobe, vibe)">
      </div>
      <div class="field">
        <label id="lblLocation">Location / environment</label>
        <input id="location" placeholder="Where is it happening? (city, time of day, lighting, atmosphere)">
      </div>

      <div class="field span2">
        <label id="lblTwist">Extra creative twist</label>
        <input id="twist" placeholder="Optional: camera move, mood, style, or one special detail.">
      </div>
    </div>

  </div>
</div>

<script>
const $ = id => document.getElementById(id);

/* ===========================
   ‚úÖ Your Lambda Function URL
=========================== */
const API_URL = "https://hhkaj4azuk6zqykrqdk2dmo6bi0mixvp.lambda-url.eu-central-1.on.aws/";
const MODEL_ID = "veo-3.1-generate-001";

/* ===========================
   Brands via ?brand=
=========================== */
const brandKey = (new URLSearchParams(location.search).get("brand") || "shaga3").toLowerCase();

const BRANDS = {
  shaga3: {
    title_en: "Shaga3app ¬∑ AI Creative Playground",
    title_ar: "ÿ¥ÿ¨Ÿëÿπ 3 ÿ¢ÿ® ¬∑ ŸÖŸÑÿπÿ® ÿßŸÑÿ•ÿ®ÿØÿßÿπ ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä",
    beta_en: "Beta ¬∑ Shaga3app powered",
    beta_ar: "ÿ®Ÿäÿ™ÿß ¬∑ ÿ®ÿØÿπŸÖ Shaga3app",
    brand: "#5b5cff",
    brand2:"#22c55e",

    /* ‚úÖ background vibe (not dark-only, tinted) */
    pageBg1:"#071021",
    pageBg2:"#050913",
    glowA:"rgba(91,92,255,.22)",
    glowB:"rgba(34,197,94,.10)",
    pillBorder:"rgba(91,92,255,.50)",
    pillBg:"rgba(91,92,255,.20)",

    /* ‚úÖ logo path (fix) */
    logo:"assets/brand-logos/shaga3.png?v=3",

    base_en:null,
    base_ar:null
  },

  cocacola: {
    title_en: "Coca-Cola ¬∑ AI Video Lab",
    title_ar: "ŸÉŸàŸÉÿßŸÉŸàŸÑÿß ¬∑ ŸÖÿπŸÖŸÑ ŸÅŸäÿØŸäŸà ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä",
    beta_en: "Demo ¬∑ Coca-Cola",
    beta_ar: "ÿØŸäŸÖŸà ¬∑ ŸÉŸàŸÉÿßŸÉŸàŸÑÿß",
    brand:"#e11d48",
    brand2:"#e11d48",

    /* ‚úÖ red theme */
    pageBg1:"#2a020a",
    pageBg2:"#120106",
    glowA:"rgba(225,29,72,.25)",
    glowB:"rgba(255,255,255,.06)",
    pillBorder:"rgba(225,29,72,.60)",
    pillBg:"rgba(225,29,72,.20)",

    logo:"assets/brand-logos/cocacola.png?v=3",

    base_en:
`BASE (LOCKED)
Create a vertical 9:16 cinematic video, 5‚Äì8 seconds long, with smooth camera moves and rich, realistic lighting.
The scene must include an ultra-realistic Coca-Cola can naturally integrated (not placed/fake).
Keep it premium, cinematic, and believable. We will inject user details below.`,
    base_ar:
`ÿßŸÑÿ£ÿ≥ÿßÿ≥ (ŸÖŸÇŸÅŸàŸÑ)
ÿßÿπŸÖŸÑ ŸÅŸäÿØŸäŸà ÿ≥ŸäŸÜŸÖÿßÿ¶Ÿä ÿπŸÖŸàÿØŸä Ÿ©:Ÿ°Ÿ¶ ŸÖÿØÿ™Ÿá ŸÖŸÜ Ÿ• ŸÑŸÄ Ÿ® ÿ´ŸàÿßŸÜŸäÿå ÿ®ÿ≠ÿ±ŸÉÿ© ŸÉÿßŸÖŸäÿ±ÿß ŸÜÿßÿπŸÖÿ© Ÿàÿ•ÿ∂ÿßÿ°ÿ© ŸàÿßŸÇÿπŸäÿ© Ÿàÿ∫ŸÜŸäÿ©.
ŸÑÿßÿ≤ŸÖ Ÿäÿ∏Ÿáÿ± ÿπŸÑÿ®ÿ© ŸÉŸàŸÉÿßŸÉŸàŸÑÿß ŸàÿßŸÇÿπŸäÿ© ÿ¨ÿØŸãÿß ŸàŸÖŸÜÿØŸÖÿ¨ÿ© ÿ∑ÿ®ŸäÿπŸä ŸÅŸä ÿßŸÑŸÖŸÉÿßŸÜ (ŸÖŸÜ ÿ∫Ÿäÿ± ŸÖÿß ÿ™ÿ®ÿßŸÜ ŸÖÿ™ÿ≠ÿ∑Ÿëÿ©/ŸÅŸäŸÉ).
ÿÆŸÑŸä ÿßŸÑÿ•ÿ≠ÿ≥ÿßÿ≥ ÿ®ÿ±ŸäŸÖŸäŸàŸÖ Ÿàÿ≥ŸäŸÜŸÖÿßÿ¶Ÿä ŸàŸàÿßŸÇÿπŸä. Ÿàÿ•ÿ≠ŸÜÿß ŸáŸÜÿ∂ŸäŸÅ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ™ÿ≠ÿ™.`
  },

  tui: {
    title_en: "TUI ¬∑ AI Video Lab",
    title_ar: "TUI ¬∑ ŸÖÿπŸÖŸÑ ŸÅŸäÿØŸäŸà ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä",
    beta_en: "Demo ¬∑ TUI",
    beta_ar: "ÿØŸäŸÖŸà ¬∑ TUI",
    brand:"#38bdf8",
    brand2:"#38bdf8",

    /* ‚úÖ light-blue theme (entire page tinted blue) */
    pageBg1:"#05202c",
    pageBg2:"#03131b",
    glowA:"rgba(56,189,248,.28)",
    glowB:"rgba(255,255,255,.06)",
    pillBorder:"rgba(56,189,248,.60)",
    pillBg:"rgba(56,189,248,.20)",

    logo:"assets/brand-logos/tui.png?v=3",

    base_en:
`BASE (LOCKED)
Create a vertical 9:16 cinematic travel-style video, 5‚Äì8 seconds long, with smooth camera moves and realistic lighting.
The scene should feel like a premium holiday destination moment (relaxed, sunny, aspirational) without showing copyrighted brand signage.
We will inject user details below.`,
    base_ar:
`ÿßŸÑÿ£ÿ≥ÿßÿ≥ (ŸÖŸÇŸÅŸàŸÑ)
ÿßÿπŸÖŸÑ ŸÅŸäÿØŸäŸà ÿ≥ŸäŸÜŸÖÿßÿ¶Ÿä ÿπŸÖŸàÿØŸä Ÿ©:Ÿ°Ÿ¶ ŸÖÿØÿ™Ÿá ŸÖŸÜ Ÿ• ŸÑŸÄ Ÿ® ÿ´ŸàÿßŸÜŸäÿå ÿ®ÿ≠ÿ±ŸÉÿ© ŸÉÿßŸÖŸäÿ±ÿß ŸÜÿßÿπŸÖÿ© Ÿàÿ•ÿ∂ÿßÿ°ÿ© ŸàÿßŸÇÿπŸäÿ©.
ÿÆŸÑŸä ÿßŸÑŸÖÿ¥ŸáÿØ ÿ•ÿ≠ÿ≥ÿßÿ≥Ÿá ÿ≥ŸÅÿ±/ÿ±ŸäŸÑÿßŸÉÿ≥ ÿ®ÿ±ŸäŸÖŸäŸàŸÖ (ÿ¥ŸÖÿ≥/ŸáÿØŸàÿ°/ŸÅÿßÿÆÿ±) ŸÖŸÜ ÿ∫Ÿäÿ± ŸÑÿßŸÅÿ™ÿßÿ™ ÿ£Ÿà ÿ¥ÿπÿßÿ±ÿßÿ™ ÿ≠ŸÇŸàŸÇŸáÿß ŸÖÿ≠ŸÅŸàÿ∏ÿ©.
Ÿàÿ•ÿ≠ŸÜÿß ŸáŸÜÿ∂ŸäŸÅ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ™ÿ≠ÿ™.`
  }
};

const BRAND = BRANDS[brandKey] || BRANDS.shaga3;

/* Apply theme vars */
document.documentElement.style.setProperty("--brand", BRAND.brand);
document.documentElement.style.setProperty("--brand2", BRAND.brand2);
document.documentElement.style.setProperty("--glowA", BRAND.glowA);
document.documentElement.style.setProperty("--glowB", BRAND.glowB);
document.documentElement.style.setProperty("--pillBorder", BRAND.pillBorder);
document.documentElement.style.setProperty("--pillBg", BRAND.pillBg);
document.documentElement.style.setProperty("--pageBg1", BRAND.pageBg1);
document.documentElement.style.setProperty("--pageBg2", BRAND.pageBg2);

/* Logo (fix path + visible) */
$("brandImg").src = BRAND.logo;
$("brandImg").onerror = () => {
  // If logo missing, keep a simple fallback circle
  $("brandImg").style.display = "none";
  document.querySelector(".logo").style.background = "rgba(255,255,255,.10)";
};

/* ===========================
   i18n
=========================== */
const i18n = {
  en: {
    heroTitle: "Play with our<br>guided video<br>prompt",
    heroDescStart: "You get up to ",
    heroDescEnd: " tries. The core concept is fixed by us; you just add your creative twist ‚ú®",
    baseLabel: "BASE CONCEPT (LOCKED)",
    locked: "üîí Locked",
    trialsLabel: "Trials left:",
    modeLabel: "CHOOSE INPUT MODE",
    modeText: "Text prompt",
    modeImg: "Start + End images",
    lblSubject: "Main subject / character",
    lblLocation: "Location / environment",
    lblTwist: "Extra creative twist",
    lblImages: "Start + End images",
    hintImages: "Upload a start frame and an end frame to guide the motion.",
    phSubject: "Who is the main character? (age, style, wardrobe, vibe)",
    phLocation: "Where is it happening? (city, time of day, lighting, atmosphere)",
    phTwist: "Optional: camera move, mood, style, or one special detail.",
    gen: "Generate video",
    dl: "Download",
    copy: "Copy link",
    saveWarn: "This page does not save your generated video. Please download it or copy the link before leaving.",
    copied: "Link copied ‚úÖ",
    waiting: "Waiting for video‚Ä¶",
    done: "Done",
    demo: "Demo",
    newly: "New"
  },
  ar: {
    heroTitle: "ÿ¨ÿ±Ÿëÿ® ŸÖÿπÿßŸÜÿß<br>ÿ®ÿ±ŸàŸÖÿ®ÿ™ ŸÅŸäÿØŸäŸà<br>ŸÖŸèŸàÿ¨ŸëŸéŸá",
    heroDescStart: "ŸÑÿØŸäŸÉ ",
    heroDescEnd: " ŸÖÿ≠ÿßŸàŸÑÿßÿ™. ÿßŸÑŸÅŸÉÿ±ÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ÿ´ÿßÿ®ÿ™ÿ©ÿõ ÿ£ŸÜÿ™ ŸÅŸÇÿ∑ ÿ£ÿ∂ŸêŸÅ ŸÑŸÖÿ≥ÿ™ŸÉ ÿßŸÑÿ•ÿ®ÿØÿßÿπŸäÿ© ‚ú®",
    baseLabel: "ÿßŸÑŸÖŸÅŸáŸàŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä (ŸÖŸÇŸÅŸàŸÑ)",
    locked: "üîí ŸÖŸÇŸÅŸàŸÑ",
    trialsLabel: "ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿßÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸäÿ©:",
    modeLabel: "ÿßÿÆÿ™ÿ± ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ•ÿØÿÆÿßŸÑ",
    modeText: "ŸÜÿµ ŸÅŸÇÿ∑",
    modeImg: "ÿµŸàÿ±ÿ™ÿßŸÜ: ÿ®ÿØÿßŸäÿ© + ŸÜŸáÿßŸäÿ©",
    lblSubject: "ÿßŸÑÿ¥ÿÆÿµŸäÿ© / ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä",
    lblLocation: "ÿßŸÑŸÖŸÉÿßŸÜ / ÿßŸÑÿ®Ÿäÿ¶ÿ©",
    lblTwist: "ÿ•ÿ∂ÿßŸÅÿ© ÿ•ÿ®ÿØÿßÿπŸäÿ©",
    lblImages: "ÿµŸàÿ±ÿ™ÿßŸÜ: ÿ®ÿØÿßŸäÿ© + ŸÜŸáÿßŸäÿ©",
    hintImages: "ÿßÿ±ŸÅÿπ ÿµŸàÿ±ÿ© ÿßŸÑÿ®ÿØÿßŸäÿ© ŸàÿµŸàÿ±ÿ© ÿßŸÑŸÜŸáÿßŸäÿ© ŸÑÿ™Ÿàÿ¨ŸäŸá ÿßŸÑÿ≠ÿ±ŸÉÿ©.",
    phSubject: "ŸÖŸäŸÜ ÿßŸÑÿ®ÿ∑ŸÑÿü (ÿ≥ŸÜ/ÿ≥ÿ™ÿßŸäŸÑ/ŸÖŸÑÿßÿ®ÿ≥/ÿ•ÿ≠ÿ≥ÿßÿ≥ ÿπÿßŸÖ)",
    phLocation: "ÿ£ŸäŸÜ ÿßŸÑŸÖŸÉÿßŸÜÿü (ŸÖÿØŸäŸÜÿ©/ŸàŸÇÿ™/ÿ•ÿ∂ÿßÿ°ÿ©/ÿ£ÿ¨Ÿàÿßÿ°)",
    phTwist: "ÿßÿÆÿ™Ÿäÿßÿ±Ÿä: ÿ≠ÿ±ŸÉÿ© ŸÉÿßŸÖŸäÿ±ÿß/ŸÖŸàÿØ/ÿ≥ÿ™ÿßŸäŸÑ/ÿ™ŸÅÿµŸäŸÑÿ© ŸÖŸÖŸäÿ≤ÿ©.",
    gen: "ÿ™ŸàŸÑŸäÿØ ŸÅŸäÿØŸäŸà",
    dl: "ÿ™ÿ≠ŸÖŸäŸÑ",
    copy: "ŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑",
    saveWarn: "ÿßŸÑÿµŸÅÿ≠ÿ© ŸÑÿß ÿ™ÿ≠ÿ™ŸÅÿ∏ ÿ®ÿßŸÑŸÅŸäÿØŸäŸà ÿßŸÑŸÜÿßÿ™ÿ¨. ŸÖŸÜ ŸÅÿ∂ŸÑŸÉ ÿ≠ŸÖŸëŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ÿ£Ÿà ÿßŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸÇÿ®ŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨.",
    copied: "ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑ ‚úÖ",
    waiting: "ÿ®ŸÜÿ≥ÿ™ŸÜŸâ ÿßŸÑŸÅŸäÿØŸäŸà‚Ä¶",
    done: "ÿ™ŸÖ",
    demo: "ÿØŸäŸÖŸà",
    newly: "ÿ¨ÿØŸäÿØ"
  }
};

function toArabicDigits(str){
  const map = {"0":"Ÿ†","1":"Ÿ°","2":"Ÿ¢","3":"Ÿ£","4":"Ÿ§","5":"Ÿ•","6":"Ÿ¶","7":"Ÿß","8":"Ÿ®","9":"Ÿ©"};
  return String(str).replace(/[0-9]/g, d => map[d]);
}

let currentLang = "en";
let trials = 3;
let generating = false;

const LAST_URL_KEY = "lab_last_video_url_" + brandKey;
function saveLastUrl(url){ try{ localStorage.setItem(LAST_URL_KEY, url); }catch(e){} }
function loadLastUrl(){ try{ return localStorage.getItem(LAST_URL_KEY) || ""; }catch(e){ return ""; } }

function applyLang(lang){
  currentLang = lang;
  const t = i18n[lang];

  $("brandText").textContent = (lang==="ar") ? BRAND.title_ar : BRAND.title_en;
  $("betaPill").textContent  = (lang==="ar") ? BRAND.beta_ar : BRAND.beta_en;

  $("heroTitle").innerHTML = t.heroTitle;
  const triesNum = (lang==="ar") ? toArabicDigits("3") : "3";
  $("heroDesc").innerHTML = `${t.heroDescStart}<b id="triesInline">${triesNum}</b>${t.heroDescEnd}`;

  $("baseLabel").textContent = t.baseLabel;
  $("lockedTag").textContent = t.locked;
  $("trialsLabel").textContent = t.trialsLabel;

  $("modeLabel").textContent = t.modeLabel;
  $("modeTextTxt").textContent = t.modeText;
  $("modeImgTxt").textContent = t.modeImg;

  $("lblSubject").textContent = t.lblSubject;
  $("lblLocation").textContent = t.lblLocation;
  $("lblTwist").textContent = t.lblTwist;
  $("lblImages").textContent = t.lblImages;

  $("subject").placeholder = t.phSubject;
  $("location").placeholder = t.phLocation;
  $("twist").placeholder = t.phTwist;

  $("genBtnTxt").textContent = t.gen;
  $("dlTxt").textContent = t.dl;
  $("copyTxt").textContent = t.copy;
  $("saveWarn").textContent = t.saveWarn;

  const bp = $("basePrompt");
  const defaultEn = bp.getAttribute("data-en") || bp.textContent;
  const defaultAr = bp.getAttribute("data-ar") || bp.textContent;
  const enText = BRAND.base_en || defaultEn;
  const arText = BRAND.base_ar || defaultAr;
  bp.textContent = (lang==="ar") ? arText : enText;

  document.body.dir = (lang==="ar") ? "rtl" : "ltr";
  document.documentElement.lang = (lang==="ar") ? "ar" : "en";
  $("langToggle").textContent = (lang==="ar") ? "EN" : "AR";

  renderCarousel();
}

$("langToggle").addEventListener("click", () => applyLang(currentLang==="en" ? "ar" : "en"));

/* Mode switching */
const imagesBox = $("imagesBox");
$("modeText").addEventListener("click", () => {
  $("modeText").classList.add("on");
  $("modeImages").classList.remove("on");
  imagesBox.style.display = "none";
});
$("modeImages").addEventListener("click", () => {
  $("modeImages").classList.add("on");
  $("modeText").classList.remove("on");
  imagesBox.style.display = "block";
});

/* ===========================
   ‚úÖ REAL FREE VIDEOS (no API keys)
   Posters are from Unsplash (fast)
   Videos are CC0 from MDN examples (stable)
=========================== */
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

/* Posters (fast) + real videos (free) */
const LIB = [
  { poster:"https://images.unsplash.com/photo-1520975682071-a5a8d49bdb4b?auto=format&fit=crop&w=900&q=70",
    video:"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4" },
  { poster:"https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=900&q=70",
    video:"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/bee.mp4" },
  { poster:"https://images.unsplash.com/photo-1482192505345-5655af888cc4?auto=format&fit=crop&w=900&q=70",
    video:"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/river.mp4" },
  { poster:"https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=900&q=70",
    video:"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4" },
  { poster:"https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=900&q=70",
    video:"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/bee.mp4" },
  { poster:"https://images.unsplash.com/photo-1514923995763-768e52f5af87?auto=format&fit=crop&w=900&q=70",
    video:"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/river.mp4" }
];

const mainVideo = $("mainVideo");
const mainPoster = $("mainPoster");
const posterOverlay = $("posterOverlay");
const playOverlay = $("playOverlay");
const metaChip = $("metaChip");
const posterName = $("posterName");
const posterTag  = $("posterTag");

let items = [];
let selectedIndex = 0;

function buildDemoItems(){
  const pool = shuffle(LIB);
  const out = [];
  for(let i=0;i<10;i++){
    const p = pool[i % pool.length];
    out.push({ id:"demo-"+i, kind:"demo", poster:p.poster, video:p.video, tag:"9:16 ¬∑ 5‚Äì8s" });
  }
  return out;
}

function hydrateGenerated(){
  const last = loadLastUrl();
  if(last){
    items = items.filter(x => x.id !== "gen-last");
    items.unshift({ id:"gen-last", kind:"new", poster: items[0]?.poster || LIB[0].poster, video:last, tag:"9:16 ¬∑ 5‚Äì8s" });
    selectedIndex = 0;
  }
}

function showPoster(it){
  mainPoster.style.backgroundImage = `url("${it.poster}")`;
  posterName.textContent = (it.kind==="new") ? (i18n[currentLang].newly) : (i18n[currentLang].demo);
  posterTag.textContent  = it.tag || "9:16 ¬∑ 5‚Äì8s";
  metaChip.textContent   = it.tag || "9:16 ¬∑ 5‚Äì8s";

  mainVideo.style.display = "none";
  posterOverlay.style.display = "flex";
  playOverlay.style.display = "grid";
}

function playVideo(it){
  mainVideo.style.display = "block";
  posterOverlay.style.display = "none";
  playOverlay.style.display = "none";

  // iOS-safe
  mainVideo.muted = true;
  mainVideo.playsInline = true;

  try{ mainVideo.pause(); }catch(e){}
  mainVideo.removeAttribute("src");
  mainVideo.load();

  mainVideo.src = it.video;
  mainVideo.load();
  mainVideo.play().catch(()=>{});
}

$("playBtn").addEventListener("click", () => {
  const it = items[selectedIndex];
  if(it) playVideo(it);
});

function renderDots(){
  const d = $("dots");
  d.innerHTML = "";
  const count = Math.min(items.length, 10);
  for(let i=0;i<count;i++){
    const dot = document.createElement("div");
    dot.className = "dot" + (i===selectedIndex ? " on" : "");
    d.appendChild(dot);
  }
}

function renderCarousel(){
  const c = $("carousel");
  c.innerHTML = "";
  const t = i18n[currentLang];

  items.forEach((it, idx) => {
    const el = document.createElement("div");
    el.className = "thumb" + (idx===selectedIndex ? " active" : "");
    el.innerHTML = `
      <div class="thumbPoster" style="background-image:url('${it.poster}')"></div>
      <div class="thumbShade"></div>
      <div class="thumbBadge">${it.kind==="new" ? t.newly : t.demo}</div>
      <div class="thumbFooter">
        <span class="lbl">${it.kind==="new" ? t.newly : t.demo}</span>
        <span class="pbtn">‚ñ∂</span>
      </div>
    `;
    el.addEventListener("click", () => {
      selectedIndex = idx;
      renderCarousel();
      renderDots();
      showPoster(items[selectedIndex]); // fast
      // tap play to actually play (user gesture)
    });
    c.appendChild(el);
  });

  renderDots();
}

/* ===========================
   Generate
=========================== */
function buildPrompt(){
  const base = $("basePrompt").textContent || "";
  const subject = ($("subject").value || "").trim();
  const location = ($("location").value || "").trim();
  const twist = ($("twist").value || "").trim();

  const parts = [];
  if(subject) parts.push(`Main subject: ${subject}`);
  if(location) parts.push(`Location: ${location}`);
  if(twist) parts.push(`Creative twist: ${twist}`);

  return `${base}\n\n---\n${parts.join("\n")}`.trim();
}

async function postJSON(payload){
  const url = API_URL + "?t=" + Date.now();
  const r = await fetch(url, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(payload),
  });

  const text = await r.text();
  let data;
  try { data = JSON.parse(text); } catch(e) { data = { raw: text }; }

  if(!r.ok){
    const msg = data?.error || data?.message || data?.raw || ("HTTP " + r.status);
    throw new Error(msg);
  }
  return data;
}

function showProgressUI(){
  $("resultBox").style.display = "block";
  $("bar").style.width = "0%";
  $("copyNote").style.display = "none";
}
function setTimerText(secondsLeft){
  if(currentLang === "ar"){
    $("timerText").textContent = secondsLeft > 0 ? toArabicDigits(`${secondsLeft} ÿ´`) : i18n.ar.waiting;
  } else {
    $("timerText").textContent = secondsLeft > 0 ? `~${secondsLeft}s` : i18n.en.waiting;
  }
}
function setDoneText(){
  $("timerText").textContent = (currentLang === "ar") ? i18n.ar.done : i18n.en.done;
}

async function realGenerate(){
  if(generating || trials <= 0) return;
  generating = true;

  trials--;
  $("trialsLeft").textContent = trials;

  showProgressUI();

  const maxSeconds = 60;
  const start = Date.now();
  let rafId;

  const tick = () => {
    const elapsed = (Date.now() - start) / 1000;
    const p = Math.min(95, (elapsed / maxSeconds) * 95);
    $("bar").style.width = p + "%";
    const remain = Math.max(0, Math.ceil(maxSeconds - elapsed));
    setTimerText(remain);
    rafId = requestAnimationFrame(tick);
  };
  tick();

  try{
    const prompt = buildPrompt();

    const gen = await postJSON({ action:"generate", modelId:MODEL_ID, prompt });
    const operationName = gen.operationName || gen.name;

    if(gen.done && gen.downloadUrl){
      $("bar").style.width = "100%";
      setDoneText();
      saveLastUrl(gen.downloadUrl);

      // Replace main preview immediately + add as New tile
      hydrateGenerated();
      renderCarousel();
      showPoster(items[0]);
      playVideo(items[0]);

      generating = false;
      cancelAnimationFrame(rafId);
      return;
    }

    if(!operationName) throw new Error("No operationName returned from generate");

    const pollEveryMs = 3000;
    const maxPolls = 25;
    let doneUrl = "";

    for(let i=0;i<maxPolls;i++){
      await new Promise(res => setTimeout(res, pollEveryMs));
      const chk = await postJSON({ action:"check", modelId:MODEL_ID, operationName });
      const url = chk?.downloadUrl || chk?.response?.downloadUrl || "";
      if(chk.done && url){ doneUrl = url; break; }
    }

    if(!doneUrl) throw new Error("Still processing. Try again in a few seconds.");

    $("bar").style.width = "100%";
    setDoneText();

    saveLastUrl(doneUrl);
    hydrateGenerated();
    renderCarousel();
    showPoster(items[0]);
    playVideo(items[0]);

  }catch(err){
    $("timerText").textContent = "Error: " + (err?.message || "Unknown error");
    $("bar").style.width = "0%";
  }finally{
    generating = false;
    if(rafId) cancelAnimationFrame(rafId);
  }
}

$("generateBtn").addEventListener("click", realGenerate);

/* Copy / Download */
function getCurrentVideoUrl(){
  const it = items[selectedIndex];
  const last = loadLastUrl();
  if(it && it.kind==="new") return it.video;
  if(mainVideo && mainVideo.src) return mainVideo.src;
  return last || (it ? it.video : "");
}

function downloadFile(url){
  if(!url) return;
  const a = document.createElement("a");
  a.href = url;
  a.download = "ai-video.mp4";
  a.target = "_blank";
  a.rel = "noopener";
  document.body.appendChild(a);
  a.click();
  a.remove();
}

$("downloadBtn").addEventListener("click", () => {
  const url = getCurrentVideoUrl();
  if(!url) return;
  saveLastUrl(url);
  downloadFile(url);
});

$("copyBtn").addEventListener("click", async () => {
  const url = getCurrentVideoUrl();
  if(!url) return;

  saveLastUrl(url);

  try{
    await navigator.clipboard.writeText(url);
    $("copyNote").style.display = "block";
    $("copyNote").textContent = (currentLang === "ar") ? i18n.ar.copied : i18n.en.copied;
  }catch(e){
    const msg = (currentLang === "ar") ? "ÿßŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸÖŸÜ ŸáŸÜÿß:" : "Copy the link from here:";
    const manual = prompt(msg, url);
    if(manual !== null){
      $("copyNote").style.display = "block";
      $("copyNote").textContent = (currentLang === "ar") ? i18n.ar.copied : i18n.en.copied;
    }
  }
});

/* Init */
(function init(){
  items = buildDemoItems();   // always fresh order
  hydrateGenerated();
  selectedIndex = 0;
  renderCarousel();
  showPoster(items[0]);
  applyLang("en");
})();
</script>
</body>
</html>
